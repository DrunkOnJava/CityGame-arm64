# SimCity ARM64 - Enhanced City Visualization Makefile

CC = clang
OBJCFLAGS = -fobjc-arc -fmodules -mmacosx-version-min=11.0
CFLAGS = -Wall -O3 -march=armv8.5-a
LDFLAGS = -framework Cocoa -framework Metal -framework MetalKit -framework CoreGraphics

# Source files
OBJC_SOURCES = src/main_city_enhanced.m
C_SOURCES = src/platform/platform_stubs.c \
            src/memory/memory_stubs.c \
            src/graphics/graphics_stubs.c \
            src/simulation/simulation_stubs.c \
            src/ai/ai_stubs.c \
            src/audio/audio_stubs.c \
            src/ui/ui_stubs.c \
            src/persistence/persistence_stubs.c \
            src/infrastructure/infrastructure_stubs.c

# Object files
OBJC_OBJECTS = $(OBJC_SOURCES:.m=.o)
C_OBJECTS = $(C_SOURCES:.c=.o)
OBJECTS = $(OBJC_OBJECTS) $(C_OBJECTS)

# Target executable
TARGET = simcity_enhanced

# Default target
all: $(TARGET)
	@echo ""
	@echo "ğŸ™ï¸ SimCity ARM64 Enhanced City Visualization Ready!"
	@echo "Run with: ./$(TARGET)"
	@echo ""
	@echo "New Features:"
	@echo "  ğŸ›£ï¸ Complete road network grid system"
	@echo "  ğŸ—ï¸ Proper depth-sorted building rendering"
	@echo "  ğŸŒ… Dynamic day/night cycle with realistic lighting"
	@echo "  ğŸš— Vehicles that follow road paths"
	@echo "  ğŸ‘¥ 2000+ pedestrians with movement AI"
	@echo "  ğŸŒ«ï¸ Distance fog for depth perception"
	@echo "  ğŸ“¸ Automatic screenshot at frame 180"

# Link executable
$(TARGET): $(OBJECTS)
	@echo "Linking $(TARGET)"
	@$(CC) $(LDFLAGS) -o $@ $^

# Compile Objective-C files
%.o: %.m
	@echo "Compiling $<"
	@$(CC) $(OBJCFLAGS) $(CFLAGS) -c $< -o $@

# Compile C files
%.o: %.c
	@echo "Compiling $<"
	@$(CC) $(CFLAGS) -c $< -o $@

# Clean build artifacts
clean:
	@echo "Cleaning build artifacts..."
	@rm -f $(OBJECTS) $(TARGET) enhanced_city_screenshot.png
	@echo "âœ¨ Clean complete!"

# Run the demo
run: $(TARGET)
	@echo "ğŸš€ Launching Enhanced City Visualization..."
	@./$(TARGET)

# Run and capture screenshot
screenshot: $(TARGET)
	@echo "ğŸ“¸ Running enhanced demo with screenshot capture..."
	@./$(TARGET)
	@echo "Screenshot saved as enhanced_city_screenshot.png"

# Performance test
benchmark: $(TARGET)
	@echo "âš¡ Running performance benchmark..."
	@echo "Measuring frame rate with enhanced rendering..."
	@time ./$(TARGET)

# Quick test (shorter runtime)
test: $(TARGET)
	@echo "ğŸ§ª Running quick test (5 seconds)..."
	@./$(TARGET) --test

.PHONY: all clean run screenshot benchmark test