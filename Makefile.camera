# SimCity ARM64 - Camera Controller Test Makefile

AS = as
CC = clang
ASFLAGS = -arch arm64
CFLAGS = -arch arm64 -O2 -Wall
LDFLAGS = -framework Carbon -framework CoreFoundation

# Source files
ASM_SOURCES = src/graphics/camera_controller_simple.s
C_SOURCES = src/test_camera_demo.c

# Object files
ASM_OBJECTS = $(ASM_SOURCES:.s=.o)
C_OBJECTS = $(C_SOURCES:.c=.o)
OBJECTS = $(ASM_OBJECTS) $(C_OBJECTS)

# Target executable
TARGET = camera_test

# Default target
all: $(TARGET)
	@echo ""
	@echo "üì∑ SimCity ARM64 Camera Controller Test Ready!"
	@echo "Run with: ./$(TARGET)"
	@echo ""
	@echo "Controls:"
	@echo "  üéÆ WASD/Arrows: Move camera"
	@echo "  ‚ö° Shift + Move: 2.5x speed boost"
	@echo "  üîç Mouse Wheel: Zoom in/out (1.15x exponential)"
	@echo "  üñ±Ô∏è  Left Click + Drag: Pan view"
	@echo "  üîÑ Right Click + Drag: Rotate camera"
	@echo "  üìê Screen edges: Auto-pan (15px threshold)"
	@echo "  üéØ ESC: Exit"

# Link executable
$(TARGET): $(OBJECTS)
	@echo "Linking $(TARGET)"
	@$(CC) $(LDFLAGS) -o $@ $^

# Assemble ARM64 files
%.o: %.s
	@echo "Assembling $<"
	@$(AS) $(ASFLAGS) -o $@ $<

# Compile C files
%.o: %.c
	@echo "Compiling $<"
	@$(CC) $(CFLAGS) -c $< -o $@

# Clean build artifacts
clean:
	@echo "Cleaning build artifacts..."
	@rm -f $(OBJECTS) $(TARGET)
	@echo "‚ú® Clean complete!"

# Run the test
run: $(TARGET)
	@echo "üöÄ Launching Camera Controller Test..."
	@./$(TARGET)

# Performance test
perf: $(TARGET)
	@echo "‚ö° Running performance test..."
	@echo "Measuring camera update performance over 10,000 frames..."
	@./$(TARGET) --perf

# Debug build
debug: CFLAGS += -g -DDEBUG
debug: ASFLAGS += -g
debug: clean $(TARGET)
	@echo "üîç Debug build complete"

.PHONY: all clean run perf debug