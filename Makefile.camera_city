# SimCity ARM64 - Camera Controller City Demo Makefile

AS = as
CC = clang
ASFLAGS = -arch arm64
OBJCFLAGS = -fobjc-arc -fmodules -mmacosx-version-min=11.0
CFLAGS = -arch arm64 -O2 -Wall
LDFLAGS = -framework Cocoa -framework Metal -framework MetalKit -framework CoreGraphics

# Source files
ASM_SOURCES = src/graphics/camera_controller_simple.s
OBJC_SOURCES = src/main_camera_city_fixed.m

# Object files
ASM_OBJECTS = $(ASM_SOURCES:.s=.o)
OBJC_OBJECTS = $(OBJC_SOURCES:.m=.o)
OBJECTS = $(ASM_OBJECTS) $(OBJC_OBJECTS)

# Target executable
TARGET = camera_city_demo

# Default target
all: $(TARGET)
	@echo ""
	@echo "üèôÔ∏è SimCity ARM64 Camera Controller City Demo Ready!"
	@echo "Run with: ./$(TARGET)"
	@echo ""
	@echo "Features:"
	@echo "  üì∑ Google Maps-style camera controls"
	@echo "  üèóÔ∏è 100x100 procedural city"
	@echo "  üéÆ Smooth physics-based movement"
	@echo "  üîç Exponential zoom (5-1000 units)"
	@echo "  üìê Edge panning support"
	@echo "  üñ±Ô∏è  Click-drag pan & rotate"

# Link executable
$(TARGET): $(OBJECTS)
	@echo "Linking $(TARGET)"
	@$(CC) $(LDFLAGS) -o $@ $^

# Assemble ARM64 files
%.o: %.s
	@echo "Assembling $<"
	@$(AS) $(ASFLAGS) -o $@ $<

# Compile Objective-C files
%.o: %.m
	@echo "Compiling $<"
	@$(CC) $(OBJCFLAGS) $(CFLAGS) -c $< -o $@

# Clean build artifacts
clean:
	@echo "Cleaning build artifacts..."
	@rm -f $(OBJECTS) $(TARGET) camera_city_screenshot.png
	@echo "‚ú® Clean complete!"

# Run the demo
run: $(TARGET)
	@echo "üöÄ Launching Camera City Demo..."
	@./$(TARGET)

# Screenshot test
screenshot: $(TARGET)
	@echo "üì∏ Running demo for screenshot..."
	@./$(TARGET) &
	@sleep 5
	@echo "Check camera_city_screenshot.png"

.PHONY: all clean run screenshot